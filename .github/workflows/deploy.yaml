name: "CI/CD Deployment"

on:
  push:
    branches:
      - develop
      - staging
      - main
  workflow_dispatch:

permissions:
  id-token: write
  contents: read

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: ${{ github.ref == 'refs/heads/main' && 'production' || github.ref == 'refs/heads/staging' && 'staging' || 'develop' }}
    env:
      server_host: ${{ vars.SERVER_HOST }}
    steps:
      - name: Checkout Code
        run: echo "Environment ${{ env.server_host }}"
    #     uses: actions/checkout@v3

    #   - name: Set Up Node.js
    #     uses: actions/setup-node@v3
    #     with:
    #       node-version: 18
    #       cache: "npm"

    #   - name: Install Dependencies
    #     run: npm install

    #   - name: Build the Application
    #     run: npm run build

    #   - name: Deploy to Server
    #     uses: appleboy/ssh-action@master
    #     with:
    #       host: ${{ secrets.SERVER_HOST }}
    #       username: ${{ secrets.SERVER_USER }}
    #       key: ${{ secrets.SERVER_SSH_KEY }}
    #       script: |
    #         cd /var/www/nodejs-app
    #         git pull origin ${{ github.ref_name }}
    #         npm install
    #         npm run build
    #         pm2 restart all
